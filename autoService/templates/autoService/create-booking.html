{% extends 'autoService/menu-layout.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/create_booking.css' %}">
{% endblock %}

{% block content %}
<form action="{% url 'create_booking' service_id %}" method="POST">
    {% csrf_token %}
    <label for="date">Дата:</label>
    {{ form.date }}

    <label for="start-time">Начало брони:</label>
    {{ form.start_time }}

    <label for="end-time">Конец брони:</label>
    {{ form.end_time }}

    <label for="car">Автомобиль:</label>
    {{ form.user_car_id }}

    <label for="box">Бокс:</label>
    {{ form.box }}

    <label for="comments">Комментарии:</label>
    {{ form.comment }}

    <label for="equipment">Оборудование:</label>
    {{ form.equipment }}

    <div>
        <p>Итоговая цена: <span id="total-price" name="total-price">0</span> руб</p>
    </div>

    <button type="submit">Забронировать</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const startTimeInput = document.getElementById('start-time');
        const endTimeInput = document.getElementById('end-time');
        const equipmentCheckboxes = document.querySelectorAll('[name="equipment"]');
        const totalPriceElement = document.getElementById('total-price');

        function calculateTotalPrice() {
            const startTime = startTimeInput.value;
            const endTime = endTimeInput.value;

            if (!startTime || !endTime) return;

            const start = new Date(`1970-01-01T${startTime}:00`);
            const end = new Date(`1970-01-01T${endTime}:00`);
            const hours = (end - start) / (1000 * 60 * 60);

            let total = 0;
            equipmentCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    const price = parseInt(checkbox.nextElementSibling.textContent.match(/(\d+)/)[1], 10);
                    total += price * hours;
                }
            });

            totalPriceElement.textContent = total;
        }

        startTimeInput.addEventListener('change', calculateTotalPrice);
        endTimeInput.addEventListener('change', calculateTotalPrice);
        equipmentCheckboxes.forEach(checkbox => checkbox.addEventListener('change', calculateTotalPrice));
    });
</script>
{% endblock %}